"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[630],{6630:(Y,c,n)=>{n.r(c),n.d(c,{UserManagementModule:()=>H});var m=n(177),d=n(8498),v=n(9417),i=n(9159),C=n(8834),g=n(9213),u=n(2798),f=n(5596),h=n(9183),t=n(7705),l=n(9967),U=n(8455);let D=(()=>{class e{constructor(s){this.firestore=s,this.collectionName="users"}getAllUsers(){const s=(0,l.rJ)(this.firestore,this.collectionName);return(0,l.xs)(s,{idField:"uid"})}updateUserRole(s,o){const r=(0,l.H9)(this.firestore,`${this.collectionName}/${s}`);return(0,U.H)((0,l.mZ)(r,{role:o}))}static{this.\u0275fac=function(o){return new(o||e)(t.KVO(l._7))}}static{this.\u0275prov=t.jDH({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var F=n(2102),R=n(6600);function j(e,a){1&e&&(t.j41(0,"div",10),t.nrm(1,"mat-spinner"),t.k0s())}function y(e,a){1&e&&(t.j41(0,"th",11),t.EFF(1," Email "),t.k0s())}function E(e,a){if(1&e&&(t.j41(0,"td",12),t.EFF(1),t.k0s()),2&e){const s=a.$implicit;t.R7$(1),t.SpI(" ",s.email," ")}}function N(e,a){1&e&&(t.j41(0,"th",11),t.EFF(1," Nom "),t.k0s())}function $(e,a){if(1&e&&(t.j41(0,"td",12),t.EFF(1),t.k0s()),2&e){const s=a.$implicit;t.R7$(1),t.SpI(" ",s.displayName||"-"," ")}}function x(e,a){1&e&&(t.j41(0,"th",11),t.EFF(1," R\xf4le "),t.k0s())}function L(e,a){if(1&e){const s=t.RV6();t.j41(0,"td",12)(1,"mat-form-field",13)(2,"mat-select",14),t.bIt("selectionChange",function(r){const M=t.eBV(s).$implicit,O=t.XpG();return t.Njj(O.updateRole(M,r))}),t.j41(3,"mat-option",15),t.EFF(4,"Admin"),t.k0s(),t.j41(5,"mat-option",16),t.EFF(6,"\xc9diteur"),t.k0s(),t.j41(7,"mat-option",17),t.EFF(8,"Spectateur"),t.k0s()()()()}if(2&e){const s=a.$implicit;t.R7$(2),t.Y8G("value",s.role)}}function T(e,a){1&e&&t.nrm(0,"tr",18)}function S(e,a){1&e&&t.nrm(0,"tr",19)}let V=(()=>{class e{constructor(s){this.userService=s,this.users=[],this.displayedColumns=["email","displayName","role"],this.loading=!0}ngOnInit(){this.loadUsers()}loadUsers(){this.loading=!0,this.userService.getAllUsers().subscribe({next:s=>{this.users=s,this.loading=!1},error:s=>{console.error("Error loading users",s),this.loading=!1}})}updateRole(s,o){const r=o.value;confirm(`Changer le r\xf4le de ${s.email} en ${r}?`)?this.userService.updateUserRole(s.uid||s.id||"",r).subscribe({next:()=>{},error:p=>{console.error(p),alert("Erreur lors de la mise \xe0 jour"),this.loadUsers()}}):this.loadUsers()}static{this.\u0275fac=function(o){return new(o||e)(t.rXU(D))}}static{this.\u0275cmp=t.VBU({type:e,selectors:[["app-user-list"]],decls:17,vars:4,consts:[[1,"user-list-container"],["class","loading-overlay",4,"ngIf"],["mat-table","",1,"users-table",3,"dataSource"],["matColumnDef","email"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","displayName"],["matColumnDef","role"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],[1,"loading-overlay"],["mat-header-cell",""],["mat-cell",""],["appearance","outline","subscriptSizing","dynamic"],[3,"value","selectionChange"],["value","admin"],["value","editor"],["value","viewer"],["mat-header-row",""],["mat-row",""]],template:function(o,r){1&o&&(t.j41(0,"div",0)(1,"h1"),t.EFF(2,"Gestion des Utilisateurs"),t.k0s(),t.j41(3,"mat-card"),t.DNE(4,j,2,0,"div",1),t.j41(5,"table",2),t.qex(6,3),t.DNE(7,y,2,0,"th",4),t.DNE(8,E,2,1,"td",5),t.bVm(),t.qex(9,6),t.DNE(10,N,2,0,"th",4),t.DNE(11,$,2,1,"td",5),t.bVm(),t.qex(12,7),t.DNE(13,x,2,0,"th",4),t.DNE(14,L,9,1,"td",5),t.bVm(),t.DNE(15,T,1,0,"tr",8),t.DNE(16,S,1,0,"tr",9),t.k0s()()()),2&o&&(t.R7$(4),t.Y8G("ngIf",r.loading),t.R7$(1),t.Y8G("dataSource",r.users),t.R7$(10),t.Y8G("matHeaderRowDef",r.displayedColumns),t.R7$(1),t.Y8G("matRowDefColumns",r.displayedColumns))},dependencies:[m.bT,i.Zl,i.tL,i.ji,i.cC,i.YV,i.iL,i.KS,i.$R,i.YZ,i.NB,F.rl,u.VO,R.wT,f.RN,h.LG],styles:[".user-list-container[_ngcontent-%COMP%]{padding:24px}.users-table[_ngcontent-%COMP%]{width:100%}.loading-overlay[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:20px}mat-form-field[_ngcontent-%COMP%]{width:150px}"]})}}return e})();var G=n(8010);const I=[{path:"",component:V,canActivate:[(()=>{class e{constructor(s,o){this.router=s,this.authService=o}canActivate(s,o){return!!this.authService.hasRole(s.data.role)||(this.router.navigate(["/"]),!1)}static{this.\u0275fac=function(o){return new(o||e)(t.KVO(d.Ix),t.KVO(G.u))}}static{this.\u0275prov=t.jDH({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})()],data:{role:["admin"]}}];let H=(()=>{class e{static{this.\u0275fac=function(o){return new(o||e)}}static{this.\u0275mod=t.$C({type:e})}static{this.\u0275inj=t.G2t({imports:[m.MD,d.iI.forChild(I),v.X1,i.tP,C.Hl,g.m_,u.Ve,f.Hu,h.D6]})}}return e})()}}]);